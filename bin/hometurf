#!/usr/bin/env ruby
# frozen_string_literal: true

if (x = __dir__)
  $:.unshift File.expand_path("../lib", x)
end
require "hometurf/app"

puts "ARGV: #{ARGV}"
puts "Project directory: #{ENV[Hometurf::Locations::PROJECT_DIR_ENVNAME]}"
puts "Home directory: #{ENV[Hometurf::Locations::HOME_DIR_ENVNAME]}"

locations = Hometurf::Locations.new
puts "locations: #{locations}"

app = Hometurf::App.new locations
args = ARGV.dup
index = 0
while (arg = args.shift)
  puts "arg: #{arg}"
  case arg
  when "update"
    # updates the home directory
    app.update
  when "add-link"
    pn = Pathname.new args.shift
    app.add_link pn
    index += 1
  when "add-home-link"
    # adds a link in ~, from the project directory
    projfile = Pathname.new args.shift
    puts "projfile: #{projfile}"
    index += 1
    link = if (name = args.shift)
             Pathname.new name
           end
    puts "link: #{link}"
    app.add_home_link projfile, link
  when "set-link"
    pn = Pathname.new args.shift
    app.set_link pn
    index += 1
  when "status"
    # shows the status of the home and project directories
    app.status
  else
    $stderr.puts "unknown command: #{arg}"
  end
end
